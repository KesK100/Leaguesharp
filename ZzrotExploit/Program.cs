using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using LeagueSharp;
using LeagueSharp.Common;
using SharpDX;
using Color = System.Drawing.Color;

namespace ZzrotExploit
{
    class Program
    {
        private static Menu Config; //menu 
        private static int zzrot = 3512; //zzrot item id number, somehow there is no built-in the item code for zzrot? 
        private static Boolean zzrotChecker = false; // checker for the user has zzrot or not
        private static InventorySlot zzrotslot; // get zzrot item 
        private static Vector3 exploitpos = new Vector3(11846, 11420, 91.42979f); //exploit location
        private static int timer = 0; // make sure dont spam zzrot too many times. It might triggers the player getting a ban because of inhuman clicks 
        private static int searchingTimer = 0; // same thing as timer, don't try to find zzrot too many times. It might causes fps drops
        static void Main(string[] args)
        {
            CustomEvents.Game.OnGameLoad += sD => // got it from imsosharp code 
            {
                zzrotChecker = false;
                Config = new Menu("Zz'rot Exploit", "zzrotexploit", true); // menu 
                Config.AddItem(new MenuItem("key", "Key").SetValue(new KeyBind((uint)Keys.A, KeyBindType.Press)));
                Config.AddItem(new MenuItem("enable", "Enable").SetValue(false));
                Game.OnUpdate += OnUpdate;
                Drawing.OnDraw += OnDraw;
                Config.AddToMainMenu();
            };
        }


        private static void OnUpdate(EventArgs args)
        {
            if (!Config.Item("enable").GetValue<bool>())
            {
                return;
            }

            if (zzrotChecker) //if player has zzrot
            {
                if (Vector3.Distance(ObjectManager.Player.ServerPosition, exploitpos) < 700 & Config.Item("key").GetValue<KeyBind>().Active && Items.CanUseItem(zzrot) && Environment.TickCount - timer > 5000)
                {
                    ObjectManager.Player.Spellbook.CastSpell(zzrotslot.SpellSlot, exploitpos); //cast to the exploit location
                    timer = Environment.TickCount;
                }
            }
            else if (zzrotChecker == false) //if player doesn't have it, keep finding
            {
                if (Environment.TickCount - searchingTimer > 1000) // don't try to find zzrot too many times. It might causes fps drops
                {
                    foreach (var zz in ObjectManager.Player.InventoryItems.Where(zz => zz.Id == (ItemId)zzrot))
                    {
                        zzrotChecker = true;
                        zzrotslot = zz;
                    }
                    searchingTimer = Environment.TickCount;
                }
            }

        }

        private static void OnDraw(EventArgs args)
        {
            if (!Config.Item("enable").GetValue<bool>())
            {
                return;
            }
            Render.Circle.DrawCircle(exploitpos, 50, Color.ForestGreen); //drawing 

        }
    }
}
